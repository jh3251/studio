{
  "entities": {
    "AppUser": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AppUser",
      "type": "object",
      "description": "Represents a person within a specific store for tracking purposes.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The UID of the authenticated Firebase user who owns this record." },
        "storeId": { "type": "string", "description": "The ID of the store this user belongs to." },
        "name": { "type": "string", "description": "Display name of the person." }
      },
      "required": ["id", "userId", "storeId", "name"]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense recorded within a specific store.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "Owner's UID." },
        "storeId": { "type": "string", "description": "The ID of the store this expense belongs to." },
        "userName": { "type": "string" },
        "categoryId": { "type": "string" },
        "date": { "type": "string", "format": "date-time" },
        "amount": { "type": "number" },
        "description": { "type": "string" }
      },
      "required": ["id", "userId", "storeId", "userName", "categoryId", "date", "amount"]
    },
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents an income recorded within a specific store.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "Owner's UID." },
        "storeId": { "type": "string", "description": "The ID of the store this income belongs to." },
        "userName": { "type": "string" },
        "date": { "type": "string", "format": "date-time" },
        "amount": { "type": "number" },
        "description": { "type": "string" }
      },
      "required": ["id", "userId", "storeId", "userName", "date", "amount"]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents an expense category within a specific store.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "Owner's UID." },
        "storeId": { "type": "string", "description": "The ID of the store this category belongs to." },
        "name": { "type": "string" },
        "icon": { "type": "string" }
      },
      "required": ["id", "userId", "storeId", "name", "icon"]
    },
    "Store": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Store",
      "type": "object",
      "description": "Represents a store or financial context managed by a user.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The UID of the user who owns this store." },
        "name": { "type": "string", "description": "The name of the store." }
      },
      "required": ["id", "userId", "name"]
    }
  },
  "auth": {
    "providers": ["email"]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/stores/{storeId}",
        "definition": {
          "entityName": "Store",
          "schema": { "$ref": "#/backend/entities/Store" },
          "description": "Stores the user's different financial contexts or 'stores'."
        }
      },
      {
        "path": "/users/{userId}/stores/{storeId}/app_users/{appUserId}",
        "definition": {
          "entityName": "AppUser",
          "schema": { "$ref": "#/backend/entities/AppUser" },
          "description": "Stores user profiles specific to a store."
        }
      },
      {
        "path": "/users/{userId}/stores/{storeId}/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": { "$ref": "#/backend/entities/Category" },
          "description": "Stores expense categories specific to a store."
        }
      },
      {
        "path": "/users/{userId}/stores/{storeId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": { "$ref": "#/backend/entities/Expense" },
          "description": "Stores expense records specific to a store."
        }
      },
      {
        "path": "/users/{userId}/stores/{storeId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": { "$ref": "#/backend/entities/Income" },
          "description": "Stores income records specific to a store."
        }
      }
    ],
    "reasoning": "The structure is now hierarchical. A top-level `users` collection holds user documents. Each user document contains a `stores` subcollection. All data (app_users, categories, expenses, incomes) is then nested under a specific store. This ensures data isolation both between users and between the different stores of a single user."
  }
}
