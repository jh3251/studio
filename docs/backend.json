{
  "entities": {
    "AppUser": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AppUser",
      "type": "object",
      "description": "Represents a person for tracking purposes.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The UID of the main authenticated user." },
        "name": { "type": "string", "description": "Display name of the person." },
        "position": { "type": "number", "description": "The order of the user in the list." }
      },
      "required": ["id", "userId", "name", "position"]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "Owner's UID." },
        "userName": { "type": "string" },
        "categoryId": { "type": "string" },
        "date": { "type": "string", "format": "date-time" },
        "amount": { "type": "number" }
      },
      "required": ["id", "userId", "userName", "categoryId", "date", "amount"]
    },
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents an income.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "Owner's UID." },
        "userName": { "type": "string" },
        "date": { "type": "string", "format": "date-time" },
        "amount": { "type": "number" }
      },
      "required": ["id", "userId", "userName", "date", "amount"]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents an expense category.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "Owner's UID." },
        "name": { "type": "string" },
        "icon": { "type": "string" },
        "position": { "type": "number", "description": "The order of the category in the list." }
      },
      "required": ["id", "userId", "name", "icon", "position"]
    }
  },
  "auth": {
    "providers": ["email"]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/app_users/{appUserId}",
        "definition": {
          "entityName": "AppUser",
          "schema": { "$ref": "#/entities/AppUser" },
          "description": "Stores user profiles."
        }
      },
      {
        "path": "/users/{userId}/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": { "$ref": "#/entities/Category" },
          "description": "Stores expense categories."
        }
      },
      {
        "path": "/users/{userId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": { "$ref": "#/entities/Expense" },
          "description": "Stores expense records."
        }
      },
      {
        "path": "/users/{userId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": { "$ref": "#/entities/Income" },
          "description": "Stores income records."
        }
      }
    ],
    "reasoning": "The database is structured around a main `users` collection. All data related to a specific user (their app users, categories, expenses, incomes) is nested under that user's document. This ensures strong data isolation between different users, making security rules straightforward and scalable."
  }
}
