{
  "entities": {
    "AppUser": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AppUser",
      "type": "object",
      "description": "Represents a person within a specific store for tracking purposes.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The UID of the authenticated Firebase user who owns the parent store." },
        "storeId": { "type": "string", "description": "The ID of the store this user belongs to." },
        "name": { "type": "string", "description": "Display name of the person." }
      },
      "required": ["id", "userId", "storeId", "name"]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense recorded within a specific store.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The UID of the authenticated Firebase user who owns the parent store." },
        "storeId": { "type": "string", "description": "The ID of the store this expense belongs to." },
        "userName": { "type": "string" },
        "categoryId": { "type": "string" },
        "date": { "type": "string", "format": "date-time" },
        "amount": { "type": "number" },
        "description": { "type": "string" }
      },
      "required": ["id", "userId", "storeId", "userName", "categoryId", "date", "amount"]
    },
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents an income recorded within a specific store.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The UID of the authenticated Firebase user who owns the parent store." },
        "storeId": { "type": "string", "description": "The ID of the store this income belongs to." },
        "userName": { "type": "string" },
        "date": { "type": "string", "format": "date-time" },
        "amount": { "type": "number" },
        "description": { "type": "string" }
      },
      "required": ["id", "userId", "storeId", "userName", "date", "amount"]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents an expense category within a specific store.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The UID of the authenticated Firebase user who owns the parent store." },
        "storeId": { "type": "string", "description": "The ID of the store this category belongs to." },
        "name": { "type": "string" },
        "icon": { "type": "string" }
      },
      "required": ["id", "userId", "storeId", "name", "icon"]
    },
    "Store": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Store",
      "type": "object",
      "description": "Represents a store or financial context managed by a user. Includes credentials for store-specific access.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The UID of the user who owns this store (the admin)." },
        "name": { "type": "string", "description": "The name of the store." },
        "email": { "type": "string", "format": "email", "description": "The email used for logging into this specific store." },
        "password": { "type": "string", "description": "The password for this store's specific login." }
      },
      "required": ["id", "userId", "name", "email", "password"]
    },
    "UserRole": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserRole",
      "type": "object",
      "description": "Links a Firebase Auth UID to a role (admin or store) and a specific store if applicable.",
      "properties": {
        "uid": { "type": "string", "description": "The Firebase Auth UID." },
        "role": { "type": "string", "enum": ["admin", "store"], "description": "The role of the user." },
        "storeId": { "type": "string", "description": "The ID of the store this user has access to. Only present for 'store' roles." },
        "adminId": { "type": "string", "description": "The UID of the admin user who owns this store. Only present for 'store' roles." }
      },
      "required": ["uid", "role"]
    }
  },
  "auth": {
    "providers": ["email"]
  },
  "firestore": {
    "structure": [
       {
        "path": "/user_roles/{uid}",
        "definition": {
          "entityName": "UserRole",
          "schema": { "$ref": "#/backend/entities/UserRole" },
          "description": "Stores the role for each Firebase authenticated user."
        }
      },
      {
        "path": "/users/{userId}/stores/{storeId}",
        "definition": {
          "entityName": "Store",
          "schema": { "$ref": "#/backend/entities/Store" },
          "description": "Stores the user's different financial contexts or 'stores'."
        }
      },
      {
        "path": "/users/{userId}/stores/{storeId}/app_users/{appUserId}",
        "definition": {
          "entityName": "AppUser",
          "schema": { "$ref": "#/backend/entities/AppUser" },
          "description": "Stores user profiles specific to a store."
        }
      },
      {
        "path": "/users/{userId}/stores/{storeId}/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": { "$ref": "#/backend/entities/Category" },
          "description": "Stores expense categories specific to a store."
        }
      },
      {
        "path": "/users/{userId}/stores/{storeId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": { "$ref": "#/backend/entities/Expense" },
          "description": "Stores expense records specific to a store."
        }
      },
      {
        "path": "/users/{userId}/stores/{storeId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": { "$ref": "#/backend/entities/Income" },
          "description": "Stores income records specific to a store."
        }
      }
    ],
    "reasoning": "The structure is hierarchical. A top-level `users` collection holds admin user documents. Each admin document contains a `stores` subcollection. All data is nested under a specific store. A new top-level `user_roles` collection maps a Firebase Auth UID to a role ('admin' or 'store') to control data access. This allows store-specific users to access only the data for their assigned store, while the admin can access all stores they own."
  }
}